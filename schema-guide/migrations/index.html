



<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-0.17.2, mkdocs-material-2.6.0">
    
    
      
        <title>The Migrations Framework - Beam Documentation</title>
      
    
    

      <link rel="stylesheet" href="../../assets/stylesheets/application.aa3de92b.css">
      
    
<link rel="stylesheet" type="text/css" href="../../css/beam.css"/>

    
      <script src="../../assets/javascripts/modernizr.1aa3b519.js"></script>
    
    
      
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    
    
      <link rel="stylesheet" href="../../docs/theme/css/beam.css">
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="drawer">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="search">
    <label class="md-overlay" data-md-component="overlay" for="drawer"></label>
    
      <a href="#basic-concepts" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../.." title="Beam Documentation" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                Beam Documentation
              </span>
              <span class="md-header-nav__topic">
                The Migrations Framework
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  


  <a href="https://github.com/tathougies/beam/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      tathougies/beam
    </div>
  </a>

          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="drawer">
    <span class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </span>
    Beam Documentation
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/tathougies/beam/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      tathougies/beam
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../about/faq/" title="Frequently Asked Questions" class="md-nav__link">
      Frequently Asked Questions
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Tutorial
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Tutorial
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/tutorial1/" title="Part 1" class="md-nav__link">
      Part 1
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/tutorial2/" title="Part 2" class="md-nav__link">
      Part 2
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/tutorial3/" title="Part 3" class="md-nav__link">
      Part 3
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      User Guide
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        User Guide
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../user-guide/models/" title="Models" class="md-nav__link">
      Models
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../user-guide/databases/" title="Databases" class="md-nav__link">
      Databases
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../user-guide/backends/" title="Backends" class="md-nav__link">
      Backends
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../user-guide/expressions/" title="Expressions" class="md-nav__link">
      Expressions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-5" type="checkbox" id="nav-4-5">
    
    <label class="md-nav__link" for="nav-4-5">
      Queries
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-4-5">
        Queries
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../user-guide/queries/basic/" title="Basic Queries" class="md-nav__link">
      Basic Queries
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../user-guide/queries/select/" title="More complex SELECTs" class="md-nav__link">
      More complex SELECTs
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../user-guide/queries/ordering/" title="Ordering" class="md-nav__link">
      Ordering
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../user-guide/queries/relationships/" title="Relationships" class="md-nav__link">
      Relationships
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../user-guide/queries/aggregates/" title="Aggregates" class="md-nav__link">
      Aggregates
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../user-guide/queries/combining-queries/" title="Combining queries" class="md-nav__link">
      Combining queries
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../user-guide/queries/window-functions/" title="Window functions" class="md-nav__link">
      Window functions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../user-guide/queries/advanced-features/" title="Advanced features" class="md-nav__link">
      Advanced features
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../user-guide/extensibility/" title="Custom queries" class="md-nav__link">
      Custom queries
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-7" type="checkbox" id="nav-4-7">
    
    <label class="md-nav__link" for="nav-4-7">
      Data Manipulation
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-4-7">
        Data Manipulation
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../user-guide/manipulation/insert/" title="INSERT" class="md-nav__link">
      INSERT
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../user-guide/manipulation/update/" title="UPDATE" class="md-nav__link">
      UPDATE
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../user-guide/manipulation/delete/" title="DELETE" class="md-nav__link">
      DELETE
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5" checked>
    
    <label class="md-nav__link" for="nav-5">
      Schema management
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Schema management
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="toc">
    
    
      <label class="md-nav__link md-nav__link--active" for="toc">
        The Migrations Framework
      </label>
    
    <a href="./" title="The Migrations Framework" class="md-nav__link md-nav__link--active">
      The Migrations Framework
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#basic-concepts" title="Basic concepts" class="md-nav__link">
    Basic concepts
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#automatic-migration-generation" title="Automatic migration generation" class="md-nav__link">
    Automatic migration generation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#advantages-of-checked-migrations" title="Advantages of checked migrations" class="md-nav__link">
    Advantages of checked migrations
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#usage-modes" title="Usage modes" class="md-nav__link">
    Usage modes
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#the-beam-migrate-library" title="The beam-migrate library" class="md-nav__link">
    The beam-migrate library
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-beam-migrate-tool" title="The beam-migrate tool" class="md-nav__link">
    The beam-migrate tool
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../tool/" title="The beam-migrate tool" class="md-nav__link">
      The beam-migrate tool
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../supported/" title="Supported migrations" class="md-nav__link">
      Supported migrations
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      Backends
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        Backends
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../user-guide/backends/beam-postgres/" title="beam-postgres" class="md-nav__link">
      beam-postgres
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../user-guide/backends/beam-sqlite/" title="beam-sqlite" class="md-nav__link">
      beam-sqlite
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../user-guide/custom-backends/" title="Writing a Custom Backend" class="md-nav__link">
      Writing a Custom Backend
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7">
    
    <label class="md-nav__link" for="nav-7">
      About
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        About
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../about/compatibility/" title="Compatibility Matrix" class="md-nav__link">
      Compatibility Matrix
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../about/license/" title="License" class="md-nav__link">
      License
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../about/release-notes/" title="Release Notes" class="md-nav__link">
      Release Notes
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#basic-concepts" title="Basic concepts" class="md-nav__link">
    Basic concepts
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#automatic-migration-generation" title="Automatic migration generation" class="md-nav__link">
    Automatic migration generation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#advantages-of-checked-migrations" title="Advantages of checked migrations" class="md-nav__link">
    Advantages of checked migrations
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#usage-modes" title="Usage modes" class="md-nav__link">
    Usage modes
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#the-beam-migrate-library" title="The beam-migrate library" class="md-nav__link">
    The beam-migrate library
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-beam-migrate-tool" title="The beam-migrate tool" class="md-nav__link">
    The beam-migrate tool
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/tathougies/beam/edit/master/docs/schema-guide/migrations.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                  <h1>The Migrations Framework</h1>
                
                <div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The <code>beam-migrations</code> package is still a WIP. The following manual
represents both planned and implemented features. If you'd like to help
guide development, please join
the
<a href="https://groups.google.com/forum/#!forum/beam-discussion"><code>beam-discussion</code> mailing list</a>.</p>
</div>
<p>In the User Guide we saw how to declare a schema for an already created database
and use it to perform queries. Beam can also manage a database schema based on
Haskell datatypes you feed it.</p>
<p>The Beam Migrations Framework is meant to be a robust, modular, and opinionated
way of managing schema changes. It is an optional part of beam provided in the
<code>beam-migrate</code> package.</p>
<p>Install the migrations framework and tool by running</p>
<div class="codehilite"><pre><span></span>$ cabal install beam-migrate
<span class="c1"># or</span>
$ stack install beam-migrate
</pre></div>


<p>This installs the <code>beam-migrate</code> library as well as a CLI tool (named
<code>beam-migrate</code> as well) which automates common tasks.</p>
<p>If you use <code>stack</code> make sure you always use <code>stack exec -- beam-migrate</code> instead
of the typical <code>beam-migrate</code> command in order to have the package path
automatically and correctly set for you.</p>
<h2 id="basic-concepts">Basic concepts</h2>
<p>In the user guide, we saw how we can use <code>defaultDbSettings</code> to generate default
metadata that can be used to access the database. This default metadata is
enough to query, but not enough for <code>beam-migrate</code>. Thus, <code>beam-migrate</code> offers
the <code>defaultMigratableDbSettings</code> function, which annotates the database schema
with additional information. Whereas <code>defaultDbSettings</code> yields a value of type
<code>DatabaseSettings be db</code>, <code>defaultMigratableDbSettings</code> yields a value of type
<code>CheckedDatabaseSettings be db</code>. You can recover a <code>DatabaseSettings be db</code> from
a <code>CheckedDatabaseSettings be db</code> value by applying the <code>unCheckDatabase</code>
function.</p>
<p>The <code>CheckedDatabaseSettings</code> value contains the original <code>DatabaseSettings</code>
along with a series of <em>predicates</em>. Each <em>predicate</em> describes one aspect of
the database. As far as <code>beam-migrate</code> is concerned, each database schema is
fully specified by the set of predicates that apply to it. <code>beam-migrate</code> calls
this the <em>checked type</em> of the database.</p>
<p>For example, a database schema that consists of one table named <code>table</code> with no
fields is represented uniquely by the <em>checked type</em> of <code>[TableExistsPredicate
"table"]</code>. If you add a field <code>field1</code> of type <code>INT</code> to the table, then the
checked type becomes <code>[TableExistsPredicate "table", TableHasColumn "table"
"field1" intType]</code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The types are a bit more complicated than what they appear. In particular, a
predicate can be of any type that satisfies the <code>DatabasePredicate</code> type
class. The predicates can be stored in a list because they are wrapped in
the <code>SomeDatabasePredicate</code> GADT that holds the type class instance as well.</p>
</div>
<h3 id="automatic-migration-generation">Automatic migration generation</h3>
<p>Given two <code>CheckedDatabaseSettings</code> values, <code>beam-migrate</code> can generate a set of
SQL steps that will transform one schema to another. The generation of such
steps is an exceedingly difficult problem in general. <code>beam-migrate</code> can
automatically handle most common cases, but it will not always succeed. In this
case, it can present to you a list of steps it thinks are best as well as what
remains to be solved.</p>
<p>The migration generation is implemented as a proof search in linear logic<sup id="fnref:1"><a class="footnote-ref" href="#fn:1" rel="footnote">1</a></sup>. In
particular, <code>beam-migrate</code> views a migration as a linear logic proof of the form
<code>a ⊸ b</code>, where <code>a</code> is the set of predicates of the original schema and <code>b</code> is
the set of predicates in the target schema. <code>beam-migrate</code> ships with a set of
default proof steps. Backends can add to these steps for backend-specific
predicates.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>At this time, Haskell does not allow the expression of linear programs (this
will change with the introduction of linear types). Thus, migrations written
in Haskell are not checked by GHC for linear-ness, but <code>beam-migrate</code> will
validate such migrations at run-time to the best of its ability.</p>
</div>
<p>The migration prover may not be able to find a migration in a sufficiently short
period of time. <code>beam-migrate</code>'s algorithm is designed to terminate, but this
may take a while. Additionally, the prover will not automatically generate steps
for some migrations. For example, <code>beam-migrate</code> will never rename a table
without explicit instructions.</p>
<p>For these cases, the <code>beam-migrate</code> command line interface offers an
<em>interactive</em> mode. Here, it presents both database types for the user's
inspection, as well as a list of steps <code>beam-migrate</code> thinks it can take based
on these types. The user can choose to let <code>beam-migrate</code> guess the next step,
or the user can select a step that <code>beam-migrate</code> offers as the next step, or
the user can enter his/her own step and select which predicates are consumed and
generated.</p>
<h3 id="advantages-of-checked-migrations">Advantages of checked migrations</h3>
<p>Unlike other database migration frameworks, the checking process allows
<code>beam-migrate</code> to be sure that the migration you specify will result in the
database type you want. Also, checked migrations allow the programmer to verify
that the database they are accessing indeed matches what their schema expects.</p>
<h2 id="usage-modes">Usage modes</h2>
<p><code>beam-migrate</code> can be used as a library or a command-line tool in <em>managed</em> or
<em>unmanaged</em> mode.</p>
<h3 id="the-beam-migrate-library">The <code>beam-migrate</code> library</h3>
<p>The <code>beam-migrate</code> library provides syntax definitions for common SQL DDL tasks.
It also provides types for expressing migrations as transformations of one or
more schemas to another. The library exports types for database backends to hook
into automated migration tools (including the <code>beam-migrate</code> tool). Finally, it
also implements the migration solver. Its use is described in the next section.</p>
<h3 id="the-beam-migrate-tool">The <code>beam-migrate</code> tool</h3>
<p>In <em>unmanaged</em> mode, the <code>beam-migrate</code> tool offers a set of convenience
functionality for generating migrations, checking databases, etc based off of a
schema. It is useful for performing one-off tasks (such as generating a
migration script) that you don't want to recompile your project for.</p>
<p><em>Managed</em> mode extends the functionality of <em>unmanaged</em> mode with tools for
managing sets of schemas and migrations between them. In this mode,
<code>beam-migrate</code> can be used to update a production or development database
schema. This mode supports schema branching and version-control integration but
forces you to adopt <code>beam-migrate</code>'s conventions.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>If you're worried about a <code>beam-migrate</code> dependency in a production
application, <code>beam-migrate</code> can be used to freeze a particular checked
database settings object. This means you get a <code>DatabaseSettings</code> value
which can be used in an application with only a <code>beam-core</code> dependency.</p>
</div>
<div class="footnote">
<hr />
<ol>
<li id="fn:1">
<p>Linear logic is a type of logic first described by Jean-Yves Gerard. In
particular, it constrains the weakening and strengthening rules of classical
logic. Intuitively, you can think of it as forcing the rule that each
assumption is used exactly once to produce the result. Read
more <a href="https://en.wikipedia.org/wiki/Linear_logic">on Wikipedia</a>.&#160;<a class="footnote-backref" href="#fnref:1" rev="footnote" title="Jump back to footnote 1 in the text">&#8617;</a></p>
</li>
</ol>
</div>
                
                  
                
              
              
                
              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../../user-guide/manipulation/delete/" title="DELETE" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                DELETE
              </span>
            </div>
          </a>
        
        
          <a href="../tool/" title="The beam-migrate tool" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                The beam-migrate tool
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="http://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
      
    </div>
  </div>
</footer>
      
    </div>
    

      <script src="../../assets/javascripts/application.9fb73e57.js"></script>
      
      <script>app.initialize({version:"0.17.2",url:{base:"../.."}})</script>
      
    
<script type="text/javascript" language="javascript"  src="https://code.jquery.com/jquery-2.2.4.min.js"></script>
<script type="text/javascript" language="javascript" src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
<script type="text/javascript" language="javascript">
 $(document.body).tab();
 $(".nav-item:first-child").tab("show");
</script>

    
      
    
  </body>
</html>